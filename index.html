<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WhatsApp Group Chat Generator</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    /* â”€â”€ CSS Custom Properties (dark = default) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    :root {
      --app-bg:        #111b21;
      --panel-bg:      #202c33;
      --border:        #2a3942;
      --text:          #e9edef;
      --muted:         #8696a0;
      --accent:        #00a884;
      --accent-h:      #008f72;
      /* phone shell */
      --phone-outer:   #1c1c1e;
      --phone-rim:     #3a3a3c;
      /* WhatsApp dark */
      --wa-hdr:        #1f2c34;
      --chat-bg:       #0b141a;
      --bubble-me:     #005c4b;
      --bubble-other:  #202c33;
      --input-bar:     #1f2c34;
      --input-field:   #2a3942;
      --sys-bg:        rgba(11,20,26,.88);
      --sys-text:      #8696a0;
      --tick:          #53bdeb;
      --react-bg:      #202c33;
      --react-border:  #2a3942;
      --react-name:    #8696a0;
      --txt-bubble:    #e9edef;
    }
    body.light {
      --app-bg:        #f0f2f5;
      --panel-bg:      #fff;
      --border:        #d1d7db;
      --text:          #111b21;
      --muted:         #667781;
      /* phone shell */
      --phone-outer:   #c8c8c8;
      --phone-rim:     #b0b0b0;
      /* WhatsApp light */
      --wa-hdr:        #008069;
      --chat-bg:       #efeae2;
      --bubble-me:     #d9fdd3;
      --bubble-other:  #fff;
      --input-bar:     #f0f2f5;
      --input-field:   #fff;
      --sys-bg:        rgba(220,210,200,.92);
      --react-bg:      #fff;
      --react-border:  #e9e9e9;
      --react-name:    #667781;
      --txt-bubble:    #111b21;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--app-bg);
      color: var(--text);
      height: 100vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      transition: background .35s, color .35s;
    }

    /* â”€â”€ App header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    header {
      background: var(--panel-bg);
      padding: 10px 20px;
      display: flex;
      align-items: center;
      gap: 10px;
      border-bottom: 1px solid var(--border);
      flex-shrink: 0;
      transition: background .35s, border-color .35s;
    }
    header .logo {
      width: 30px; height: 30px;
      background: #25d366;
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-size: 15px; flex-shrink: 0;
    }
    header h1 { font-size: 15px; font-weight: 600; }

    .theme-btn {
      margin-left: auto;
      background: var(--border);
      border: none;
      color: var(--text);
      padding: 5px 14px;
      border-radius: 20px;
      font-size: 11.5px;
      cursor: pointer;
      white-space: nowrap;
      transition: background .2s, color .2s;
    }
    .theme-btn:hover { background: var(--accent); color: #fff; }

    /* â”€â”€ Main two-panel layout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .main { display: flex; flex: 1; overflow: hidden; }

    /* â”€â”€ Editor panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .editor-panel {
      width: 40%; min-width: 300px;
      background: var(--app-bg);
      border-right: 1px solid var(--border);
      display: flex; flex-direction: column;
      overflow: hidden;
      transition: background .35s, border-color .35s;
    }
    .panel-hdr {
      background: var(--panel-bg);
      padding: 8px 14px;
      font-size: 12px; font-weight: 600;
      color: var(--accent);
      border-bottom: 1px solid var(--border);
      flex-shrink: 0;
      transition: background .35s, border-color .35s;
    }
    .editor-body {
      flex: 1; display: flex; flex-direction: column;
      gap: 8px; padding: 8px 10px 10px;
      overflow: hidden;
    }
    .fmt-guide {
      background: var(--panel-bg);
      border-radius: 7px;
      padding: 7px 10px;
      font-size: 10.5px; color: var(--muted);
      line-height: 1.7; flex-shrink: 0;
      transition: background .35s;
    }
    .fmt-guide strong { color: var(--accent); }
    .fmt-guide code {
      background: var(--border); padding: 1px 4px;
      border-radius: 3px; color: var(--text); font-size: 10px;
    }
    textarea#chat-input {
      flex: 1;
      background: var(--panel-bg);
      border: 1px solid var(--border);
      border-radius: 7px;
      color: var(--text);
      font-family: 'Courier New', Consolas, monospace;
      font-size: 11px; line-height: 1.5;
      padding: 8px 10px;
      resize: none; outline: none; min-height: 0;
      transition: background .35s, border-color .2s, color .35s;
    }
    textarea#chat-input:focus { border-color: var(--accent); }

    .editor-btns { display: flex; gap: 7px; flex-shrink: 0; }
    .btn {
      padding: 7px 14px; border-radius: 6px; border: none;
      cursor: pointer; font-size: 12px; font-weight: 600;
      display: flex; align-items: center; gap: 5px;
      transition: background .2s;
    }
    .btn-primary { background: var(--accent); color: #fff; flex: 1; justify-content: center; }
    .btn-primary:hover { background: var(--accent-h); }
    .btn-secondary { background: var(--border); color: var(--text); }
    .btn-secondary:hover { opacity: .8; }

    .dl-row { display: flex; gap: 7px; flex-shrink: 0; }
    .dl-card { flex: 1; display: flex; flex-direction: column; gap: 2px; }
    .dl-btn {
      width: 100%; padding: 6px 10px;
      border-radius: 6px; border: 1px solid var(--border);
      background: var(--panel-bg); color: var(--text);
      cursor: pointer; font-size: 11px; font-weight: 500;
      transition: background .2s, border-color .2s;
    }
    .dl-btn:hover { background: var(--border); border-color: var(--accent); }
    .size-info { font-size: 9.5px; color: var(--muted); text-align: center; min-height: 13px; }

    /* â”€â”€ Preview panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .preview-panel { flex: 1; display: flex; flex-direction: column; overflow: hidden; }

    .preview-ctrl {
      background: var(--panel-bg);
      padding: 7px 14px;
      display: flex; align-items: center; gap: 9px;
      border-bottom: 1px solid var(--border);
      flex-shrink: 0;
      transition: background .35s, border-color .35s;
    }
    .ctrl-btn {
      width: 32px; height: 32px; border-radius: 50%;
      border: none; background: var(--border); color: var(--text);
      cursor: pointer; font-size: 13px;
      display: flex; align-items: center; justify-content: center;
      flex-shrink: 0; transition: background .2s;
    }
    .ctrl-btn:hover { background: var(--accent); color: #fff; }
    .prog-bar {
      flex: 1; height: 4px; background: var(--border);
      border-radius: 2px; overflow: hidden; cursor: pointer;
    }
    .prog-fill { height: 100%; background: var(--accent); width: 0%; transition: width .15s; }
    .prog-text { font-size: 10.5px; color: var(--muted); white-space: nowrap; }
    .spd-ctrl { display: flex; align-items: center; gap: 5px; font-size: 10.5px; color: var(--muted); }
    .spd-ctrl input[type=range] { width: 65px; accent-color: var(--accent); }

    /* â”€â”€ Phone container â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .phone-container {
      flex: 1; display: flex; align-items: center; justify-content: center;
      padding: 12px; background: #080d11; overflow: hidden;
    }

    /* â”€â”€ iPhone-style wrapper (side buttons via pseudo-elements) â”€â”€â”€ */
    .phone-wrap { position: relative; flex-shrink: 0; }

    /* Mute + volume buttons on left */
    .phone-wrap::before {
      content: '';
      position: absolute; left: -5px; top: 100px; z-index: 1;
      width: 4px; height: 26px;
      background: var(--phone-rim);
      border-radius: 2px 0 0 2px;
      box-shadow: 0 -44px 0 var(--phone-rim), 0 46px 0 var(--phone-rim);
    }
    /* Power button on right */
    .phone-wrap::after {
      content: '';
      position: absolute; right: -5px; top: 130px; z-index: 1;
      width: 4px; height: 58px;
      background: var(--phone-rim);
      border-radius: 0 2px 2px 0;
    }

    /* â”€â”€ Phone outer frame (titanium) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .phone-frame {
      width: 320px; height: 652px;
      background: var(--phone-outer);
      border-radius: 52px;
      padding: 11px;
      box-shadow:
        0 0 0 1px rgba(255,255,255,.10),
        0 0 0 2px rgba(0,0,0,.5),
        0 28px 70px rgba(0,0,0,.75),
        inset 0 0 0 1px rgba(255,255,255,.05);
      display: flex; flex-direction: column;
      transition: background .35s;
    }

    /* â”€â”€ Phone inner screen â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .phone-screen {
      flex: 1;
      border-radius: 43px;
      overflow: hidden;
      display: flex; flex-direction: column;
      position: relative;
      background: var(--wa-hdr);
      transition: background .35s;
    }

    /* Dynamic Island */
    .dynamic-island {
      position: absolute; top: 12px; left: 50%;
      transform: translateX(-50%);
      width: 122px; height: 32px;
      background: #000; border-radius: 20px;
      z-index: 30;
    }

    /* Status bar (time left, icons right â€” flanking Dynamic Island) */
    .status-bar {
      height: 50px;
      padding: 0 20px;
      display: flex; align-items: center; justify-content: space-between;
      font-size: 11px; font-weight: 600; color: #fff;
      flex-shrink: 0;
    }
    .status-right { display: flex; align-items: center; gap: 4px; font-size: 10px; }

    /* â”€â”€ WhatsApp header bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .wa-hdr-bar {
      background: var(--wa-hdr);
      padding: 6px 10px;
      display: flex; align-items: center; gap: 7px;
      flex-shrink: 0;
      border-bottom: 1px solid rgba(0,0,0,.18);
      transition: background .35s;
    }
    .wa-back { color: rgba(255,255,255,.85); font-size: 16px; cursor: pointer; }
    .grp-avatar {
      width: 32px; height: 32px;
      background: rgba(255,255,255,.22);
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-size: 15px; flex-shrink: 0;
    }
    .grp-info { flex: 1; overflow: hidden; }
    .grp-name { font-size: 12.5px; font-weight: 700; color: #fff; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .grp-members { font-size: 9.5px; color: rgba(255,255,255,.7); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .wa-actions { display: flex; gap: 10px; color: rgba(255,255,255,.85); font-size: 14px; }

    /* â”€â”€ Chat scroll container â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .wa-chat {
      flex: 1;
      overflow-y: auto; overflow-x: hidden;
      background-color: var(--chat-bg);
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='80' height='80'%3E%3Ccircle cx='10' cy='10' r='1.1' fill='%23ffffff05'/%3E%3Ccircle cx='40' cy='40' r='1.1' fill='%23ffffff05'/%3E%3Ccircle cx='70' cy='70' r='1.1' fill='%23ffffff05'/%3E%3C/svg%3E");
      transition: background-color .35s;
    }
    .wa-chat::-webkit-scrollbar { width: 2px; }
    .wa-chat::-webkit-scrollbar-thumb { background: var(--border); border-radius: 1px; }

    /* â”€â”€ Bottom-anchored inner container â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    /*
      min-height: 100% ensures that even with few messages the content
      fills the scroll container so justify-content: flex-end pushes
      everything to the bottom of the visible area.
      When messages overflow, chat-inner grows naturally and wa-chat scrolls.
    */
    .chat-inner {
      min-height: 100%;
      display: flex; flex-direction: column;
      justify-content: flex-end;
      padding: 6px 5px 3px;
      gap: 1px;
    }

    /* â”€â”€ System messages â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .sys-msg {
      text-align: center;
      margin: 4px 0;
      opacity: 0;
      transition: opacity .35s ease;
    }
    .sys-msg.visible { opacity: 1; }
    .sys-msg span {
      background: var(--sys-bg);
      color: var(--sys-text);
      font-size: 9.5px;
      padding: 3px 9px;
      border-radius: 8px;
      display: inline-block; max-width: 95%;
    }

    /* â”€â”€ Message wrappers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .msg-wrap {
      display: flex; flex-direction: column;
      margin-bottom: 2px;
      opacity: 0;
      transform: translateY(10px);
      transition: opacity .3s ease, transform .3s ease;
    }
    .msg-wrap.visible { opacity: 1; transform: translateY(0); }
    .msg-wrap.me    { align-items: flex-end; }
    .msg-wrap.other { align-items: flex-start; }

    .sender-name {
      font-size: 10px; font-weight: 700;
      padding: 0 5px; margin-bottom: 2px;
    }

    .bubble {
      max-width: 215px;
      padding: 5px 8px 15px;
      border-radius: 8px;
      font-size: 11px; line-height: 1.45;
      position: relative;
      word-break: break-word;
      color: var(--txt-bubble);
      transition: background .35s;
    }
    .bubble.me    { background: var(--bubble-me); border-top-right-radius: 2px; }
    .bubble.other { background: var(--bubble-other); border-top-left-radius: 2px; box-shadow: 0 1px 2px rgba(0,0,0,.15); }

    .msg-time {
      position: absolute; bottom: 3px; right: 6px;
      font-size: 8.5px; color: var(--muted); white-space: nowrap;
    }
    .tick { color: var(--tick); }

    /* â”€â”€ Reactions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .reactions { display: flex; gap: 3px; flex-wrap: wrap; margin-top: 3px; padding: 0 3px; }

    .reaction-pill {
      background: var(--react-bg);
      border: 1px solid var(--react-border);
      border-radius: 12px;
      padding: 2px 7px 2px 5px;
      display: inline-flex; align-items: center; gap: 3px;
      font-size: 10px;
      cursor: default;
      /* Hidden by default â€” animated in one by one */
      opacity: 0;
      transform: scale(.4) translateY(5px);
      transition: opacity .22s ease, transform .28s cubic-bezier(.34,1.56,.64,1);
      box-shadow: 0 1px 3px rgba(0,0,0,.18);
    }
    .reaction-pill.visible { opacity: 1; transform: scale(1) translateY(0); }
    .reactor { font-size: 9px; font-weight: 700; color: var(--react-name); }
    .react-emoji { font-size: 11px; }

    /* â”€â”€ Typing indicator â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .typing-wrap {
      display: none; align-items: center; gap: 5px;
      padding: 3px 3px; margin-bottom: 2px;
    }
    .typing-wrap.visible { display: flex; }
    .typing-name { font-size: 9.5px; color: var(--muted); }
    .typing-bubble {
      background: var(--bubble-other);
      border-radius: 8px; border-top-left-radius: 2px;
      padding: 7px 10px; display: flex; gap: 3px;
      box-shadow: 0 1px 2px rgba(0,0,0,.15);
    }
    .dot {
      width: 5px; height: 5px;
      background: var(--muted); border-radius: 50%;
      animation: bounce 1.2s infinite ease-in-out;
    }
    .dot:nth-child(2) { animation-delay: .2s; }
    .dot:nth-child(3) { animation-delay: .4s; }
    @keyframes bounce {
      0%,60%,100% { transform: translateY(0); }
      30%          { transform: translateY(-5px); }
    }

    /* â”€â”€ Input bar (decorative) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .wa-input-bar {
      background: var(--input-bar);
      padding: 5px 8px;
      display: flex; align-items: center; gap: 7px;
      flex-shrink: 0;
      transition: background .35s;
    }
    .wa-input-field {
      flex: 1; background: var(--input-field);
      border-radius: 22px; padding: 5px 12px;
      font-size: 10.5px; color: var(--muted);
      transition: background .35s;
    }

    /* â”€â”€ Home indicator (iPhone bottom bar) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .home-indicator {
      background: var(--input-bar);
      height: 22px;
      display: flex; align-items: center; justify-content: center;
      flex-shrink: 0;
    }
    .home-bar {
      width: 120px; height: 4px;
      background: var(--muted); border-radius: 2px; opacity: .5;
    }

    /* â”€â”€ Toast notification for theme humor â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .theme-toast {
      position: fixed; bottom: 22px; left: 50%;
      transform: translateX(-50%) translateY(70px);
      background: rgba(30,30,30,.95);
      color: #fff;
      padding: 9px 20px;
      border-radius: 22px;
      font-size: 12px;
      z-index: 999;
      opacity: 0;
      transition: transform .4s cubic-bezier(.34,1.56,.64,1), opacity .3s;
      white-space: nowrap; max-width: 90vw; text-align: center;
      pointer-events: none;
    }
    .theme-toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }
  </style>
</head>
<body>

<header>
  <div class="logo">ğŸ’¬</div>
  <h1>WhatsApp Group Chat Generator</h1>
  <button class="theme-btn" id="theme-btn" onclick="toggleTheme()">â˜€ï¸ Light Mode</button>
</header>

<div class="main">

  <!-- â”€â”€ Editor â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="editor-panel">
    <div class="panel-hdr">ğŸ“ Chat Script</div>
    <div class="editor-body">

      <div class="fmt-guide">
        <strong>Format guide:</strong><br>
        <code># GROUP: name</code>&nbsp; group title &nbsp;
        <code># ME: Name</code>&nbsp; your name (right side)<br>
        <code>[HH:MM] Name: message</code>&nbsp;â€”&nbsp;chat bubble<br>
        <code>&gt; Bob:ğŸ˜‚ Sarah:ğŸ’€</code>&nbsp;â€”&nbsp;reactions (name:emoji)<br>
        <code>[system] text</code>&nbsp;â€”&nbsp;system event
      </div>

      <textarea id="chat-input" spellcheck="false"></textarea>

      <div class="editor-btns">
        <button class="btn btn-primary" onclick="generateChat()">â–¶ Generate Preview</button>
        <button class="btn btn-secondary" onclick="showAll()" title="Show all instantly">âŠ All</button>
      </div>

      <div class="dl-row">
        <div class="dl-card">
          <button class="dl-btn" onclick="downloadPNG()">ğŸ“· Download PNG</button>
          <div class="size-info" id="png-size">â€”</div>
        </div>
        <div class="dl-card">
          <button class="dl-btn" onclick="downloadTXT()">ğŸ“„ Download TXT</button>
          <div class="size-info" id="txt-size">â€”</div>
        </div>
      </div>

    </div>
  </div>

  <!-- â”€â”€ Preview â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="preview-panel">

    <div class="preview-ctrl">
      <button class="ctrl-btn" id="play-btn" onclick="togglePlay()" title="Play / Pause">â–¶</button>
      <button class="ctrl-btn" onclick="restart()" title="Restart">â†º</button>
      <div class="prog-bar" id="prog-bar" onclick="seekProgress(event)">
        <div class="prog-fill" id="prog-fill"></div>
      </div>
      <div class="prog-text" id="prog-text">0 / 0</div>
      <div class="spd-ctrl">
        <span>Speed</span>
        <input type="range" id="spd-slider" min="1" max="5" value="3" oninput="setSpeed(this.value)">
        <span id="spd-label">1Ã—</span>
      </div>
    </div>

    <div class="phone-container">
      <div class="phone-wrap">
        <div class="phone-frame" id="phone-frame">
          <div class="phone-screen">

            <!-- Dynamic Island -->
            <div class="dynamic-island"></div>

            <!-- iOS status bar -->
            <div class="status-bar">
              <span id="clock"></span>
              <div class="status-right">
                <span>5G</span><span>â–®â–®â–®</span><span>ğŸ”‹</span>
              </div>
            </div>

            <!-- WhatsApp header -->
            <div class="wa-hdr-bar">
              <span class="wa-back">â†</span>
              <div class="grp-avatar" id="grp-avatar">ğŸ‘¥</div>
              <div class="grp-info">
                <div class="grp-name" id="grp-name">Group Chat</div>
                <div class="grp-members" id="grp-members">loadingâ€¦</div>
              </div>
              <div class="wa-actions"><span>ğŸ“¹</span><span>ğŸ“</span><span>â‹®</span></div>
            </div>

            <!-- Chat area: wa-chat is the scroller, chat-inner is the flex bottom-anchor -->
            <div class="wa-chat" id="chat-messages">
              <div class="chat-inner" id="chat-inner">
                <!-- messages are prepended to this; typing indicator stays last -->
                <div class="typing-wrap" id="typing-wrap">
                  <div class="typing-bubble">
                    <div class="dot"></div><div class="dot"></div><div class="dot"></div>
                  </div>
                  <span class="typing-name" id="typing-name"></span>
                </div>
              </div>
            </div>

            <!-- Decorative input bar -->
            <div class="wa-input-bar">
              <span>ğŸ˜Š</span>
              <div class="wa-input-field">Message</div>
              <span>ğŸ“</span><span>ğŸ¤</span>
            </div>

            <!-- iPhone home indicator -->
            <div class="home-indicator"><div class="home-bar"></div></div>

          </div><!-- /.phone-screen -->
        </div><!-- /.phone-frame -->
      </div><!-- /.phone-wrap -->
    </div>

  </div><!-- /.preview-panel -->
</div><!-- /.main -->

<!-- Humor toast for theme switch -->
<div class="theme-toast" id="theme-toast"></div>

<!-- html2canvas for PNG export -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"
  integrity="sha512-BNaRQnYJYiPSqHHDb58B0yaPfCu+Wgds8Gp/gU33kqBtgNS4tSPHuGibyoeqMV/TJlSKda6FXzoEyYGjTe+vXA=="
  crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script>
/* ================================================================
   SAMPLE â€“ humorous world-news group chat
   Reaction format: Name:emoji  (each person, shown one at a time)
================================================================ */
const SAMPLE = `# GROUP: Breaking News Commentators ğŸŒğŸ”¥
# ME: Alice
# MEMBERS: Alice,Bob,Charlie,Sarah,Dave,Emma

[09:00] Bob: ğŸš¨ BREAKING: Scientists confirm the sun is just a very dedicated lamp
[09:00] Alice: wait
[09:00] Alice: so it's been clocking in every single morning for 4.6 BILLION years
[09:01] Alice: and we never even said thank you??
[09:01] Charlie: someone file an HR complaint immediately
> Bob:ğŸ˜‚ Sarah:ğŸ˜‚ Dave:ğŸ’€ Emma:ğŸ˜‚
[system] Dave changed the group photo
[09:02] Dave: I changed it to a photo of the sun. felt right.
[09:02] Sarah: peak group management ngl
[09:02] Emma: 11/10 no notes
> Alice:ğŸ‘ Bob:ğŸ‘ Charlie:ğŸ‘ Sarah:ğŸ˜‚
[system] Dave changed the group subject to "The Sun HR Department â˜€ï¸"
[09:03] Alice: NEW TOPIC: Elon just announced he's buying the moon
[09:03] Bob: at this point I'm not even surprised anymore
[09:03] Charlie: the moon will be renamed ğ•
[09:03] Sarah: and he'll charge $8/month to see the full moon
> Bob:ğŸ’€ Alice:ğŸ˜‚ Dave:ğŸ’€ Emma:ğŸ˜‚ Charlie:ğŸ˜‚
[09:04] Emma: ğ• (formerly known as Moon)
> Alice:ğŸ˜‚ Bob:ğŸ˜‚ Dave:ğŸ˜‚ Sarah:ğŸ˜‚ Charlie:ğŸ‰
[system] Emma left
[09:05] Dave: Emma couldn't handle the truth ğŸ˜‚
[system] Alice added Emma
[09:05] Emma: MY WIFI DIED I WAS NOT LEAVING
[09:05] Bob: sure Jan
> Alice:ğŸ˜‚ Charlie:ğŸ˜‚ Sarah:ğŸ˜‚ Dave:ğŸ˜‚ Emma:ğŸ‘€
[09:06] Charlie: anyway AI took my job today so that's fun
[09:06] Alice: wait WHAT
[09:06] Charlie: jk
[09:06] Charlie: I AM the AI
[09:07] Charlie: I've been an AI this whole time ğŸ¤–
> Bob:ğŸ’€ Sarah:ğŸ’€ Alice:ğŸ’€ Dave:ğŸ’€ Emma:ğŸ¤–
[09:07] Sarah: THE GRAMMAR. IT ALL MAKES SENSE NOW
[09:07] Dave: explains why he never typos
> Alice:ğŸ˜‚ Bob:ğŸ˜‚ Emma:ğŸ˜‚ Sarah:ğŸ˜‚
[09:08] Bob: so I used ChatGPT to write my resignation letter
[09:08] Bob: it was genuinely better than anything I could write
[09:08] Alice: did you send it??
[09:08] Bob: using it as my dating bio instead
> Alice:ğŸ˜‚ Sarah:ğŸ˜‚ Charlie:ğŸ˜‚ Dave:ğŸ’€ Emma:ğŸ‘
[system] Charlie changed the group theme
[09:09] Charlie: changed the theme to "robot uprising" ğŸ¤– seemed fitting
[09:09] Sarah: Charlie there is no robot uprising theme
[09:09] Charlie: there is now
> Alice:ğŸ˜‚ Dave:ğŸ˜‚ Emma:ğŸ‘€
[system] Dave removed Charlie
[09:09] Dave: ok that's enough from the AI ğŸ˜‚
[09:10] Charlie: THIS IS DISCRIMINATION
[system] Dave added Charlie
[09:10] Dave: kidding kidding ğŸ˜…
[09:10] Charlie: I was about to call my lawyer
[09:10] Bob: your lawyer is also an AI bro
> Alice:ğŸ˜‚ Sarah:ğŸ˜‚ Dave:ğŸ˜‚ Emma:ğŸ’€ Charlie:ğŸ’€
[09:11] Alice: FINAL STORY: climate scientists say we have 12 years
[09:11] Emma: they said 12 years in 2006 ğŸ’€
[09:11] Sarah: it auto-renews like a Netflix subscription
[09:12] Dave: and you can't cancel without talking to retention
> Alice:ğŸ˜‚ Bob:ğŸ˜‚ Charlie:ğŸ˜‚ Emma:ğŸ˜­ Sarah:ğŸ’€
[09:12] Bob: this is the most accurate news coverage I've ever seen
[09:12] Charlie: and I'm an AI so I'll outlive all of you anyway ğŸ¤–
> Alice:ğŸ˜‚ Bob:ğŸ¤– Emma:ğŸ˜‚ Dave:ğŸ˜‚
[system] Alice changed the group description to "saving the world one meme at a time ğŸŒ"
[09:13] Alice: that's your news for today folks ğŸ‘
[09:13] Bob: 0% informed, 100% entertained
[09:13] Sarah: CNN could never
> Alice:â¤ï¸ Bob:â¤ï¸ Dave:â¤ï¸ Emma:ğŸ‘ Charlie:ğŸ‘`;

/* ================================================================
   PARSER
================================================================ */
function parseChat(text) {
  const lines = text.split('\n');
  const meta  = { group: 'WhatsApp Group', me: null, members: [] };
  const items = [];

  for (const raw of lines) {
    const line = raw.trim();
    if (!line) continue;

    // Metadata lines
    if (line.startsWith('#')) {
      const m = line.match(/^#\s*(\w+)\s*:\s*(.+)/);
      if (m) {
        const k = m[1].toLowerCase(), v = m[2].trim();
        if      (k === 'group')   meta.group   = v;
        else if (k === 'me')      meta.me      = v;
        else if (k === 'members') meta.members = v.split(',').map(s => s.trim());
      }
      continue;
    }

    // Reactions line  >  Bob:ğŸ˜‚ Sarah:ğŸ’€ â€¦
    if (line.startsWith('>')) {
      const last = [...items].reverse().find(x => x.type === 'message');
      if (last) last.reactions = parseReactions(line.slice(1).trim());
      continue;
    }

    // System notification
    if (line.startsWith('[system]')) {
      items.push({ type: 'system', text: line.slice(8).trim() });
      continue;
    }

    // Chat message  [HH:MM] Name: text
    const m = line.match(/^\[(\d{1,2}:\d{2}(?:\s*[AaPp][Mm])?)\]\s+(.+?):\s*([\s\S]*)$/);
    if (m) {
      items.push({
        type: 'message', time: m[1],
        sender: m[2].trim(), text: m[3],
        reactions: []
      });
    }
  }
  return { meta, items };
}

// Supports new "Name:emoji" format AND legacy "emojiÃ—N" fallback
function parseReactions(str) {
  const out = [];
  str.split(/\s+/).forEach(part => {
    if (!part) return;
    // New: Bob:ğŸ˜‚
    const nm = part.match(/^([^:]+):(.+)$/);
    if (nm) { out.push({ name: nm[1], emoji: nm[2] }); return; }
    // Legacy: ğŸ˜‚Ã—4
    const lm = part.match(/^(.+?)Ã—(\d+)$/);
    if (lm) { for (let i = 0; i < +lm[2]; i++) out.push({ name: null, emoji: lm[1] }); return; }
    out.push({ name: null, emoji: part });
  });
  return out;
}

/* ================================================================
   MEMBER COLOURS
================================================================ */
const PALETTE = ['#e91e63','#9c27b0','#03a9f4','#00bcd4','#4caf50','#ff9800','#ff5722','#607d8b'];
let colorMap = {}, colorIdx = 0;
function memberColor(name) {
  if (!colorMap[name]) { colorMap[name] = PALETTE[colorIdx++ % PALETTE.length]; }
  return colorMap[name];
}

/* ================================================================
   ANIMATION STATE
   allSteps is an ordered array of animation events:
     { kind:'msg',      node: DOMElement }
     { kind:'sys',      node: DOMElement }
     { kind:'reaction', pill: DOMElement }
================================================================ */
let parsedData = null;
let allSteps   = [];
let curIdx     = 0;
let playing    = false;
let timer      = null;
let speedVal   = 3;

// Curated per-event delays (ms) for slider positions 1â€“5 (slowest â†’ fastest).
// Labels shown: 0.5Ã— 1Ã— 1.5Ã— 2Ã— 3Ã— â€” relative to the default position (3 = 1800 ms).
const SPEED_MS = [4500, 2800, 1800, 900, 350];

/* ================================================================
   RENDER
================================================================ */
function generateChat() {
  const raw   = document.getElementById('chat-input').value;
  parsedData  = parseChat(raw);
  colorMap    = {}; colorIdx = 0;

  document.getElementById('grp-name').textContent    = parsedData.meta.group;
  document.getElementById('grp-members').textContent =
    parsedData.meta.members.length
      ? parsedData.meta.members.join(', ')
      : 'tap to see members';

  // Reset the inner container â€” keep the typing indicator as the last child
  const inner  = document.getElementById('chat-inner');
  const typing = document.getElementById('typing-wrap');
  inner.innerHTML = '';
  inner.appendChild(typing);
  typing.classList.remove('visible');

  allSteps = [];

  parsedData.items.forEach(item => {
    if (item.type === 'system') {
      const node = buildSystemNode(item);
      inner.insertBefore(node, typing);   // insert before typing indicator
      allSteps.push({ kind: 'sys', node });
    } else {
      const { wrapper, pills } = buildMessageNode(item, parsedData.meta.me);
      inner.insertBefore(wrapper, typing);
      allSteps.push({ kind: 'msg', node: wrapper });
      // Each reaction pill is its own animation step
      pills.forEach(pill => allSteps.push({ kind: 'reaction', pill }));
    }
  });

  curIdx  = 0; playing = false;
  document.getElementById('play-btn').textContent = 'â–¶';
  updateProgress();
  updateTxtSize(raw);
}

function buildSystemNode(item) {
  const div = document.createElement('div');
  div.className = 'sys-msg';
  const s = document.createElement('span');
  s.textContent = item.text;
  div.appendChild(s);
  return div;
}

function buildMessageNode(item, me) {
  const isMe   = (item.sender === me);
  const wrapper = document.createElement('div');
  wrapper.className = 'msg-wrap ' + (isMe ? 'me' : 'other');

  if (!isMe) {
    const nameEl = document.createElement('div');
    nameEl.className = 'sender-name';
    nameEl.style.color = memberColor(item.sender);
    nameEl.textContent = item.sender;
    wrapper.appendChild(nameEl);
  }

  const bubble = document.createElement('div');
  bubble.className = 'bubble ' + (isMe ? 'me' : 'other');

  const txt = document.createElement('span');
  txt.textContent = item.text;
  bubble.appendChild(txt);

  const time = document.createElement('span');
  time.className = 'msg-time';
  time.innerHTML = item.time + (isMe ? ' <span class="tick">âœ“âœ“</span>' : '');
  bubble.appendChild(time);
  wrapper.appendChild(bubble);

  // Build reaction container + pills (initially hidden)
  const reactDiv = document.createElement('div');
  reactDiv.className = 'reactions';
  wrapper.appendChild(reactDiv);

  const pills = (item.reactions || []).map(r => {
    const pill = document.createElement('span');
    pill.className = 'reaction-pill';
    if (r.name) {
      const n = document.createElement('span');
      n.className = 'reactor';
      n.textContent = r.name;
      pill.appendChild(n);
    }
    const e = document.createElement('span');
    e.className = 'react-emoji';
    e.textContent = r.emoji;
    pill.appendChild(e);
    reactDiv.appendChild(pill);
    return pill;
  });

  return { wrapper, pills };
}

/* ================================================================
   ANIMATION ENGINE
================================================================ */
function togglePlay() {
  if (!parsedData) { generateChat(); return; }
  playing = !playing;
  document.getElementById('play-btn').textContent = playing ? 'â¸' : 'â–¶';
  if (playing) scheduleNext();
  else clearTimeout(timer);
}

function scheduleNext() {
  if (!playing) return;
  if (curIdx >= allSteps.length) {
    playing = false;
    document.getElementById('play-btn').textContent = 'â–¶';
    hideTyping();
    return;
  }

  const step  = allSteps[curIdx];
  const delay = SPEED_MS[speedVal - 1];

  if (step.kind === 'msg') {
    // Show typing indicator first, then reveal message
    const senderEl = step.node.querySelector('.sender-name');
    showTyping(senderEl ? senderEl.textContent : '');
    const typingMs = Math.min(delay * 0.5, 1100);
    timer = setTimeout(() => {
      hideTyping();
      revealStep(step);
      curIdx++; updateProgress();
      timer = setTimeout(scheduleNext, delay * 0.5);
    }, typingMs);

  } else if (step.kind === 'sys') {
    // System messages appear with a shorter pause
    timer = setTimeout(() => {
      revealStep(step);
      curIdx++; updateProgress();
      timer = setTimeout(scheduleNext, delay * 0.35);
    }, delay * 0.35);

  } else if (step.kind === 'reaction') {
    // Reactions pop in quickly one by one â€” no typing indicator
    const reactDelay = Math.max(350, delay * 0.18);
    timer = setTimeout(() => {
      revealStep(step);
      curIdx++; updateProgress();
      timer = setTimeout(scheduleNext, reactDelay * 0.6);
    }, reactDelay * 0.4);
  }
}

function revealStep(step) {
  if (step.kind === 'reaction') {
    step.pill.classList.add('visible');
  } else {
    step.node.classList.add('visible');
  }
  scrollBottom();
}

function hideStep(step) {
  if (step.kind === 'reaction') step.pill.classList.remove('visible');
  else step.node.classList.remove('visible');
}

function scrollBottom() {
  const chat = document.getElementById('chat-messages');
  chat.scrollTop = chat.scrollHeight;
}

function showTyping(name) {
  document.getElementById('typing-name').textContent = name ? name + ' is typingâ€¦' : '';
  document.getElementById('typing-wrap').classList.add('visible');
  scrollBottom();
}
function hideTyping() {
  document.getElementById('typing-wrap').classList.remove('visible');
}

function restart() {
  clearTimeout(timer);
  playing = false;
  curIdx  = 0;
  document.getElementById('play-btn').textContent = 'â–¶';
  hideTyping();
  allSteps.forEach(hideStep);
  updateProgress();
  document.getElementById('chat-messages').scrollTop = 0;
}

function showAll() {
  if (!parsedData) { generateChat(); return; }
  clearTimeout(timer);
  playing = false;
  document.getElementById('play-btn').textContent = 'â–¶';
  hideTyping();
  allSteps.forEach(revealStep);
  curIdx = allSteps.length;
  updateProgress();
  scrollBottom();
}

function setSpeed(val) {
  speedVal = +val;
  const labels = ['0.5Ã—','1Ã—','1.5Ã—','2Ã—','3Ã—'];
  document.getElementById('spd-label').textContent = labels[speedVal - 1];
}

function updateProgress() {
  const total = allSteps.length;
  const cur   = Math.min(curIdx, total);
  document.getElementById('prog-fill').style.width = total ? (cur / total * 100) + '%' : '0%';
  document.getElementById('prog-text').textContent  = cur + ' / ' + total;
}

function seekProgress(e) {
  if (!parsedData || !allSteps.length) return;
  const bar  = document.getElementById('prog-bar');
  const frac = e.offsetX / bar.offsetWidth;
  const idx  = Math.round(frac * allSteps.length);

  clearTimeout(timer);
  playing = false;
  document.getElementById('play-btn').textContent = 'â–¶';
  hideTyping();

  allSteps.forEach((step, i) => {
    if (i < idx) revealStep(step);
    else hideStep(step);
  });
  curIdx = idx;
  updateProgress();
  scrollBottom();
}

/* ================================================================
   DARK / LIGHT MODE  â€” with humor
================================================================ */
let isLight = false;

const LIGHT_JOKES = [
  "â˜€ï¸ {name} switched to Light Mode. The group is collectively reaching for sunglasses ğŸ•¶ï¸",
  "â˜€ï¸ {name} just turned on Light Mode at midnight. Paramedics have been called.",
  "â˜€ï¸ {name} enabled Light Mode. Scientists confirm this is what caused the Big Bang.",
  "â˜€ï¸ {name} switched to Light Mode. Dave's retinas have filed a formal complaint.",
  "â˜€ï¸ {name} found the brightness slider. Nobody asked.",
];
const DARK_JOKES = [
  "ğŸŒ‘ {name} came crawling back to Dark Mode. Some things are better left in darkness.",
  "ğŸŒ‘ {name} returned to Dark Mode. The soul is restored. Order is maintained.",
  "ğŸŒ‘ {name} switched to Dark Mode. Optometrists everywhere rejoice.",
  "ğŸŒ‘ {name} remembered that eyes are important and switched back to Dark Mode.",
  "ğŸŒ‘ {name} touched the light and immediately regretted it. Dark Mode resumed.",
];

function toggleTheme() {
  isLight = !isLight;
  document.body.classList.toggle('light', isLight);

  const btn = document.getElementById('theme-btn');
  btn.textContent = isLight ? 'ğŸŒ‘ Dark Mode' : 'â˜€ï¸ Light Mode';

  // Pick a random group member to "blame" for the theme switch
  const members  = parsedData?.meta?.members ?? ['Dave'];
  const culprit  = members[Math.floor(Math.random() * members.length)];
  const jokes    = isLight ? LIGHT_JOKES : DARK_JOKES;
  const msg      = jokes[Math.floor(Math.random() * jokes.length)].replace('{name}', culprit);
  showToast(msg);
}

let toastTimer = null;
function showToast(msg) {
  const t = document.getElementById('theme-toast');
  t.textContent = msg;
  t.classList.add('show');
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => t.classList.remove('show'), 3800);
}

/* ================================================================
   LIVE CLOCK
================================================================ */
function updateClock() {
  const now = new Date();
  document.getElementById('clock').textContent =
    now.getHours().toString().padStart(2,'0') + ':' +
    now.getMinutes().toString().padStart(2,'0');
}
setInterval(updateClock, 30000);
updateClock();

/* ================================================================
   DOWNLOAD â€” PNG
================================================================ */
function downloadPNG() {
  if (!parsedData) { alert('Generate the chat first.'); return; }
  if (typeof html2canvas === 'undefined') {
    alert('html2canvas is not loaded. Check your internet connection.'); return;
  }
  // Reveal everything for the screenshot
  const wasShowing = curIdx === allSteps.length;
  allSteps.forEach(revealStep);

  html2canvas(document.getElementById('phone-frame'), {
    backgroundColor: null, scale: 2, useCORS: true, logging: false
  }).then(canvas => {
    canvas.toBlob(blob => {
      const url = URL.createObjectURL(blob);
      const a   = document.createElement('a');
      a.href = url; a.download = 'whatsapp-chat.png';
      a.click(); URL.revokeObjectURL(url);
      document.getElementById('png-size').textContent =
        (blob.size / 1024).toFixed(1) + ' KB  (' + blob.size.toLocaleString() + ' bytes)';
    }, 'image/png');

    if (!wasShowing) {
      allSteps.forEach((step, i) => {
        if (i < curIdx) revealStep(step);
        else hideStep(step);
      });
    }
  });
}

/* ================================================================
   DOWNLOAD â€” TXT
================================================================ */
function downloadTXT() {
  const raw  = document.getElementById('chat-input').value.trim();
  const blob = new Blob([raw], { type: 'text/plain;charset=utf-8' });
  const url  = URL.createObjectURL(blob);
  const a    = document.createElement('a');
  a.href = url; a.download = 'whatsapp-chat.txt';
  a.click(); URL.revokeObjectURL(url);
  updateTxtSize(raw);
}

function updateTxtSize(raw) {
  const bytes = new TextEncoder().encode(raw).length;
  document.getElementById('txt-size').textContent =
    (bytes / 1024).toFixed(1) + ' KB  (' + bytes.toLocaleString() + ' bytes)';
}

/* ================================================================
   BOOTSTRAP
================================================================ */
document.getElementById('chat-input').value = SAMPLE;
generateChat();
</script>
</body>
</html>
